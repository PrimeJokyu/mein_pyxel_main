# 第 14 回：【確認テスト】サウンドと敵の動きの理解度チェック

**～学んだ技術を組み合わせて実力を確認しよう！～**

## 🎯 今日のゴール

- サウンド・敵の動きパターン・データ保存の基本技術を確認する
- 複数の技術を組み合わせる統合力をテストする
- 4 つの課題を通して実践的なスキルを証明する
- 自分の実力を客観的に把握し、次のステップに進む準備をする

---

## ⏰ テスト概要

**時間**: 80 分  
**形式**: 実技問題 4 課題  
**評価**: 各課題の動作確認 + 統合力評価  
**合格基準**: 4 課題中 3 課題以上で主要機能が動作すること

---

## 🔊 課題 A：サウンド実装（20 分）

### 課題内容

キー入力に応じたサウンド再生と視覚効果のシステムを実装してください。

### 実装要件

#### 必須機能

1. **キー 1 ～ 4 で異なる効果音を再生**

   - キー 1: 音階 1 の音（例：ド）
   - キー 2: 音階 2 の音（例：レ）
   - キー 3: 音階 3 の音（例：ミ）
   - キー 4: 音階 4 の音（例：ファ）

2. **キーを押すと画面の色も変化**

   - キー 1: 背景色を赤系に
   - キー 2: 背景色を青系に
   - キー 3: 背景色を緑系に
   - キー 4: 背景色を黄系に

3. **音の再生中は「♪」マークを表示**
   - 音が鳴っている間だけマークが表示される
   - マークの位置は画面中央
   - マークは白色で表示

### 実装のヒント

```python
import pyxel

# 音楽ノート番号（参考）
NOTE_C4 = 60  # ド
NOTE_D4 = 62  # レ
NOTE_E4 = 64  # ミ
NOTE_F4 = 65  # ファ

pyxel.init(160, 120)

# サウンドを事前に定義
pyxel.sound(0).set(...) # キー1用の音
pyxel.sound(1).set(...) # キー2用の音
# ... 残りのサウンドを定義

def update():
    # キー入力の判定
    # 音の再生
    # 背景色の設定

def draw():
    # 背景描画
    # ♪マークの表示判定・描画
    # 操作説明の表示

pyxel.run(update, draw)
```

### 評価ポイント

- 各キーで異なる音が正しく再生される
- 背景色が適切に変化する
- ♪ マークが音の再生中のみ表示される
- 操作が直感的で分かりやすい

---

## 👾 課題 B：敵の基本動作（20 分）

### 課題内容

画面を往復する敵キャラクターとプレイヤーの距離計算システムを実装してください。

### 実装要件

#### 必須機能

1. **画面を左右に往復する敵を 1 体配置**

   - 敵は赤色の円（半径 8px）で表示
   - 画面左端（X=10）から右端（X=150）まで移動
   - 端に到達すると方向転換して往復

2. **プレイヤー（矢印キーで操作）を配置**

   - プレイヤーは青色の円（半径 6px）で表示
   - 矢印キーで 4 方向に移動可能
   - 画面外に出ないよう境界制限

3. **敵とプレイヤーの距離を計算して画面表示**
   - 距離を整数で表示（小数点以下切り捨て）
   - 画面左上に「Distance: XXX」形式で表示
   - 距離が 30 以下の場合は警告色（赤）で表示

### 実装のヒント

```python
import pyxel
import math

# 初期位置
enemy_x = 10
enemy_y = 60
enemy_dx = 2  # 敵の移動速度

player_x = 80
player_y = 60

def update():
    global enemy_x, enemy_dx, player_x, player_y

    # 敵の移動処理
    enemy_x += enemy_dx
    if enemy_x <= 10 or enemy_x >= 150:
        enemy_dx = -enemy_dx  # 方向転換

    # プレイヤーの移動処理（矢印キー）
    # 距離計算: math.sqrt((dx)**2 + (dy)**2)

def draw():
    pyxel.cls(1)

    # 敵を描画（赤色の円）
    pyxel.circfill(enemy_x, enemy_y, 8, 8)

    # プレイヤーを描画（青色の円）
    pyxel.circfill(player_x, player_y, 6, 12)

    # 距離を計算・表示
    distance = int(math.sqrt((player_x - enemy_x)**2 + (player_y - enemy_y)**2))
    color = 8 if distance > 30 else 8  # 距離に応じた色
    pyxel.text(5, 5, f"Distance: {distance}", color)
```

### 評価ポイント

- 敵が正しく往復移動する
- プレイヤーが矢印キーで操作できる
- 距離計算が正確
- 距離が 30 以下で警告表示される

---

## 💾 課題 C：簡単なデータ保存（20 分）

### 課題内容

プレイヤー名の入力・ハイスコア表示・スコアカウントシステムを実装してください。

### 実装要件

#### 必須機能

1. **プレイヤーの名前を入力・表示**

   - 最初に「Enter your name:」と表示
   - 英数字キーで名前入力（最大 8 文字）
   - Enter キーで確定
   - 確定後は画面左上に名前を常時表示

2. **ゲーム開始時にハイスコア（固定値で OK）を表示**

   - 画面右上に「High Score: 1500」などと表示
   - 値は固定で構わない

3. **スコアをカウントして画面表示**
   - スペースキーでスコア+10
   - 現在のスコアを画面下部中央に表示
   - 「Score: XXX」形式

### 実装のヒント

```python
import pyxel

# ゲーム状態
game_state = "input"  # "input" -> "game"
player_name = ""
current_score = 0
high_score = 1500

pyxel.init(160, 120)

def update():
    global game_state, player_name, current_score

    if game_state == "input":
        # 名前入力処理
        # 英数字の検出とplayer_nameに追加
        # Enterキーでgame_stateを"game"に変更
        pass

    elif game_state == "game":
        # ゲーム中の処理
        if pyxel.btnp(pyxel.KEY_SPACE):
            current_score += 10

def draw():
    pyxel.cls(1)

    if game_state == "input":
        pyxel.text(50, 50, "Enter your name:", 7)
        pyxel.text(50, 65, player_name + "_", 7)  # カーソル表示
        pyxel.text(40, 80, "Press ENTER to start", 7)

    elif game_state == "game":
        # プレイヤー名表示
        pyxel.text(5, 5, f"Player: {player_name}", 7)

        # ハイスコア表示
        pyxel.text(100, 5, f"High: {high_score}", 7)

        # 現在スコア表示
        pyxel.text(70, 100, f"Score: {current_score}", 7)

        # 操作説明
        pyxel.text(50, 60, "Press SPACE for +10", 7)
```

### 評価ポイント

- 名前入力システムが動作する
- ハイスコアが表示される
- スコアカウントが正しく動作する
- 画面遷移が適切

---

## 🎮 課題 D：システム組み合わせ（20 分）

### 課題内容

上記 A ～ C の要素を 1 つのプログラムに統合し、全システムが連携して動作することを確認してください。

### 実装要件

#### 必須機能

1. **課題 A ～ C の全機能を 1 つのプログラムに統合**

   - サウンド再生システム
   - 敵の移動とプレイヤー操作
   - データ表示システム

2. **統合時の調整**

   - キー入力の競合を回避
   - 画面表示の配置調整
   - システム間の干渉を防ぐ

3. **動作確認**
   - 全機能が同時に正常動作
   - パフォーマンスに大きな問題がない
   - 操作が混乱しない

### 実装のヒント

```python
import pyxel
import math

# 全ての変数を統合
game_state = "input"
player_name = ""

# プレイヤー・敵
player_x = 80
player_y = 60
enemy_x = 10
enemy_y = 60
enemy_dx = 2

# スコア・サウンド
current_score = 0
high_score = 1500
sound_playing = 0
bg_color = 1

pyxel.init(160, 120)

# サウンド設定
pyxel.sound(0).set("c3e3g3c4", "t", "7", "n", 10)
pyxel.sound(1).set("d3f3a3d4", "t", "7", "n", 10)
pyxel.sound(2).set("e3g3b3e4", "t", "7", "n", 10)
pyxel.sound(3).set("f3a3c4f4", "t", "7", "n", 10)

def update():
    # 全システムの統合処理
    pass

def draw():
    # 全要素の描画
    pass

pyxel.run(update, draw)
```

### 評価ポイント

- 全機能が統合されて動作する
- キー入力の重複や競合がない
- 画面表示が整理されている
- 全体的な完成度

---

## 📝 合格基準

### 基本要件

- **4 課題中 3 課題以上**で基本機能が動作する
- 各課題の**必須機能がすべて実装**されている
- プログラムが**エラーなく実行**される

### 評価ポイント

#### 技術実装（40 点）

- **サウンド機能**（10 点）: 音の再生と視覚効果
- **敵の動作**（10 点）: 移動パターンと距離計算
- **データ管理**（10 点）: 入力・表示・スコア管理
- **システム統合**（10 点）: 複数機能の組み合わせ

#### 動作安定性（30 点）

- プログラムがエラーなく実行される
- 意図通りの動作をする
- パフォーマンスに大きな問題がない

#### コード品質（20 点）

- 読みやすいコード構造
- 適切な変数・関数名
- 必要最小限のコメント

#### 創意工夫（10 点）

- 要件を超えた機能追加
- ユーザビリティの向上
- 独創的なアイデア

---

## 💡 テスト対策のポイント

### 事前準備

1. **基本機能の復習**

   - `pyxel.sound()`, `pyxel.play()`の使い方
   - 敵の移動パターン実装
   - データ表示システム

2. **よく使う処理の確認**

   - 距離計算: `math.sqrt((dx)**2 + (dy)**2)`
   - 往復移動: 境界での方向転換
   - 状態管理: ゲーム状態の切り替え

3. **統合のコツ**
   - 変数名の統一
   - 機能ごとの処理分離
   - キー入力の整理

### 時間配分

- **課題 A**: 20 分（サウンド機能）
- **課題 B**: 20 分（敵の動作）
- **課題 C**: 20 分（データ管理）
- **課題 D**: 15 分（統合作業）
- **見直し**: 5 分（動作確認）

### よくあるミス

- サウンドの定義し忘れ
- 敵の境界判定ミス
- プレイヤー入力の処理忘れ
- 距離計算での型変換忘れ
- 画面表示の配置ミス

---

## 🚀 テスト後の振り返り

### 自己評価チェックリスト

- [ ] サウンドシステムを正しく実装できた
- [ ] 敵の動作パターンを理解している
- [ ] データ管理の基本ができる
- [ ] 複数システムを統合できる
- [ ] 時間内に課題を完成させられた
